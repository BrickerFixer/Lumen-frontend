<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lumen â€” Make Your Own Logo</title>
<link rel="stylesheet" href="/resources/styles/branding.css">
</head>
<body>
  <div id="stage" class="stage" aria-live="polite" aria-label="Type in the search bar to customize the Lumen logo.">
    <div id="logo" class="logo">
      <span class="i">I</span><span class="rest">ndex</span>
    </div>
    <div class="hint">Type in the search bar to make your own Lumen logo</div>
  </div>
<script>
(() => {
  const stage = document.getElementById('stage');
  const logo = document.getElementById('logo');
  let last = '';

  // Split a string into [pre, highlightedChar, post]
  // - highlight first 'i' or 'I' if present; else highlight first character
  function splitForHighlight(s) {
    const arr = [...s]; // code-point safe
    if (!arr.length) return ['', '', ''];
    let idx = arr.findIndex(c => c.toLowerCase() === 'l');
    if (idx < 0) idx = 0;
    return [arr.slice(0, idx).join(''), arr[idx] || '', arr.slice(idx + 1).join('')];
  }

  function setText(text) {
    let s = (text || '').replace(/\s+/g, ' ').trim();
    if (!s) s = 'Lumen';

    if (s === last) return;
    last = s;

    const [pre, hi, post] = splitForHighlight(s);
    // Clear and rebuild as text nodes to avoid HTML injection
    logo.innerHTML = '';
    if (pre) {
      const preSpan = document.createElement('span');
      preSpan.className = 'rest';
      preSpan.textContent = pre;
      logo.appendChild(preSpan);
    }
    if (hi) {
      const iSpan = document.createElement('span');
      iSpan.className = 'i';
      iSpan.textContent = hi;
      logo.appendChild(iSpan);
    }
    if (post) {
      const postSpan = document.createElement('span');
      postSpan.className = 'rest';
      postSpan.textContent = post;
      logo.appendChild(postSpan);
    }
  }

  // Try to hook into parent's search box (#q or first search input)
  function attachToParent() {
    try {
      if (window.parent === window) return; // not in an iframe
      const pd = window.parent.document;
      const input = pd.getElementById('q') || pd.querySelector('input[type="search"], input[name="q"]');
      if (input) {
        const sync = () => setText(input.value);
        input.addEventListener('input', sync, { passive: true });
        // Initial sync
        setText(input.value);
      }
    } catch (e) {
      // Cross-origin or sandboxed; rely on postMessage or ?q= param
    }
  }

  // Accept postMessage updates: { type: "index:query", q: "..." }
  window.addEventListener('message', (e) => {
    try {
      // If you want stricter checks, compare e.origin with location.origin
      if (!e || !e.data) return;
      const d = e.data;
      if (d.type === 'index:query' || d.type === 'index-query') {
        setText(String(d.q || ''));
      }
    } catch (_) {}
  });

  // Fallback: read ?q= from iframe URL if provided
  function readQueryParam() {
    const q = new URLSearchParams(location.search).get('q');
    if (q) setText(q);
  }


  // Init
  readQueryParam();
  attachToParent();
  setText(last); // ensure render if nothing else ran
})();
</script>
</body>
</html>