<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lumen â€” Settings</title>
  <link href="/resources/styles/universal.css" rel="stylesheet">
  <style>
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .page {
      width: min(92vw, 640px);
      margin: 0 auto;
      padding: var(--hdr-h) 0 24px;
      flex: 1 0 auto;
    }
    .page-header {
      margin-bottom: 24px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--hair);
    }
    .page-header h1 {
      margin: 0;
      font-size: 2rem;
    }
    .settings-group {
      margin-bottom: 24px;
    }
    .settings-group h2 {
      margin-top: 0;
      font-size: 1.25rem;
      color: var(--fg);
    }
    .setting {
      margin-bottom: 16px;
    }
    .setting label {
      display: block;
      margin-bottom: 4px;
      font-weight: 500;
    }
    .setting .description {
      font-size: 14px;
      color: var(--muted);
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <header id="hdr" class="hdr" style="--hdr-h:72px">
    <div class="hdr-inner">
      <div class="bar">
        <a href="/" aria-label="Lumen home">
          <img class="logo-img" src="/resources/service-icons/mini-mini.png" alt="Lumen">
        </a>
        <div style="display:flex; gap:8px;">
          <button id="fastlaneBtn" class="icon-btn" aria-label="Fastlane">
            <img class="icon" src="/resources/svg/dashboard_24dp_E3E3E3_FILL0_wght400_GRAD0_opsz24.svg">
          </button>
        </div>
      </div>

      <div id="fastlane" class="fastlane" aria-hidden="true">
        <div class="fl-grid">
          <div class="fl-item"><div class="ico"></div><span>Mail</span></div>
          <div class="fl-item"><div class="ico"></div><span>Docs</span></div>
          <a href="/settings"><div class="fl-item"><div class="ico"></div><span>Settings</span></div></a>
          <div class="fl-item"><div class="ico"></div><span>Profile</span></div>
          <div class="fl-item"><div class="ico"></div><span>Shortcuts</span></div>
          <div class="fl-item"><div class="ico"></div><span>Labs</span></div>
        </div>
      </div>
    </div>
  </header>

  <main class="page">
    <div class="page-header">
      <h1>Settings (WIP, page filled with placeholders)</h1>
    </div>
    
    <div class="settings-group">
      <h2>General</h2>
      <div class="setting">
        <label for="theme">Theme</label>
        <select id="theme" class="sel">
          <option value="system">System default</option>
          <option value="light">Light</option>
          <option value="dark">Dark</option>
        </select>
        <div class="description">Choose the theme for the application</div>
      </div>
      
      <div class="setting">
        <label for="language">Language</label>
        <select id="language" class="sel">
          <option value="en">English</option>
          <option value="es">Spanish</option>
          <option value="fr">French</option>
        </select>
        <div class="description">Select your preferred language</div>
      </div>
    </div>
    
    <div class="settings-group">
      <h2>Search</h2>
      <div class="setting">
        <label for="defaultNode">Default Node</label>
        <input type="text" id="defaultNode" class="flt-input" value="http://localhost:3000">
        <div class="description">The default node to use for searches</div>
      </div>
      
      <div class="setting">
        <label>
          <input type="checkbox" id="safeSearch"> Safe Search
        </label>
        <div class="description">Filter explicit content from search results</div>
      </div>
    </div>
    
    <div class="settings-group">
      <h2>Privacy</h2>
      <div class="setting">
        <label>
          <input type="checkbox" id="doNotTrack"> Do Not Track
        </label>
        <div class="description">Send "Do Not Track" requests with your searches</div>
      </div>
      
      <div class="setting">
        <label>
          <input type="checkbox" id="clearHistory"> Clear search history on exit
        </label>
        <div class="description">Automatically clear your search history when you close the browser</div>
      </div>
    </div>
  </main>
  <script>
    // Fastlane toggle
    const hdr = document.getElementById('hdr');
    const fastlaneBtn = document.getElementById('fastlaneBtn');
    const fastlane = document.getElementById('fastlane');
    let fastlaneOpen = false;
    function applyHeaderState() {
      hdr.classList.toggle('is-fastlane', fastlaneOpen);
      fastlane.classList.toggle('open', fastlaneOpen);
      fastlane.setAttribute('aria-hidden', String(!fastlaneOpen));
    }
    fastlaneBtn.addEventListener('click', () => { fastlaneOpen = !fastlaneOpen; applyHeaderState(); });
    window.addEventListener('keydown', (e) => { if (e.key === 'Escape' && fastlaneOpen) { fastlaneOpen = false; applyHeaderState(); } });
    
    // Version info
    (function() {
      const feSpan = document.getElementById('feVersion');
      const nodeSpan = document.getElementById('nodeVersion');
      
      // Frontend version
      const feMeta = document.querySelector('meta[name="app:version"]');
      const FRONTEND_VERSION = (window.__FRONTEND_VERSION__ || (feMeta && feMeta.content) || 'dev').trim();
      feSpan.textContent = `Frontend v${FRONTEND_VERSION}`;
      
      // Node info
      function getDefaultNode() {
        try {
          const u = new URL(window.location.href);
          return u.searchParams.get('node') || 'http://localhost:3000';
        } catch {
          return 'http://localhost:3000';
        }
      }
      
      async function fetchNodeInfo(nodeBase) {
        const info = { name: '', version: '' };
        
        async function getJSON(url, ms = 2500) {
          const ctrl = new AbortController();
          const t = setTimeout(() => ctrl.abort(), ms);
          try {
            const res = await fetch(url, { signal: ctrl.signal });
            if (!res.ok) throw new Error('HTTP ' + res.status);
            return await res.json();
          } finally {
            clearTimeout(t);
          }
        }
        
        try {
          const meta = await getJSON(nodeBase + '/metadata');
          info.name = meta && (meta.name || '');
          info.version = (meta && (meta.version || meta.nodeVersion)) || '';
        } catch {}
        
        if (!info.version) {
          try {
            const health = await getJSON(nodeBase + '/health');
            info.version = (health && (health.version || health.nodeVersion)) || '';
          } catch {}
        }
        
        if (!info.name) {
          try { info.name = new URL(nodeBase).host; } catch { info.name = nodeBase; }
        }
        return info;
      }
      
      async function updateNodeFooter(nodeBase) {
        try {
          const info = await fetchNodeInfo(nodeBase);
          const verText = info.version ? ` v${info.version}` : '';
          nodeSpan.textContent = `Node: ${info.name}${verText}`;
        } catch {
          nodeSpan.textContent = 'Node: offline';
        }
      }
      
      const initialNode = getDefaultNode();
      updateNodeFooter(initialNode);
    })();
  </script>
</body>
</html>