<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Logo font -->
  <link href="resources/fonts/firasans-extra-condensed-googlefonts.css" rel="stylesheet">

  <title>Index</title>
  <style>
    :root {
      --bg: #ffffff;
      --fg: #0f1115;
      --muted: #6b7177;
      --hair: #e5e7eb;
      --acc: #92BAC2;
      --hdr-h: 60px;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0f1115;
        --fg: #f3f4f6;
        --muted: #9aa3aa;
        --hair: #1f2428;
        --acc: #B8EAF5;
      }
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font: 15px/1.45 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    /* Header (same component as home, transforms to show filters/fastlane) */
    .hdr {
      position: sticky;
      top: 0;
      z-index: 1000;
      background: var(--bg);
      border-bottom: 1px solid var(--hair);
      overflow: hidden;
      transition: height .25s ease;
      height: var(--hdr-h);
      min-height: 56px;
    }

    .hdr-inner {
      max-width: 1240px;
      margin: 0 auto;
      padding: 8px 16px;
      display: grid;
      grid-template-rows: 60px auto auto;
    }

    .bar {
      display: flex;
      align-items: center;
      height: 60px;
      justify-content: space-between;
    }

    .logo-img {
      height: 50px;
      object-fit: contain;
      display: block;
    }

    .q {
      height: 40px;
      border: 2px solid var(--acc);
      background: var(--bg);
      color: var(--fg);
      padding: 0 12px;
      font: 15px/1.2 inherit;
      outline: none;
      width: 100%;
    }

    .icon-btn {
      appearance: none;
      border: none;
      background: transparent;
      color: var(--fg);
      width: 36px;
      height: 36px;
      display: grid;
      place-items: center;
      cursor: pointer;
    }

    .icon {
      width: 24px;
      height: 24px;
      display: block;
    }

    .filters {
      display: grid;
      grid-template-columns: repeat(2, auto);
      gap: 8px;
      align-items: center;
      padding: 8px 0 10px;
      border-top: 1px solid var(--hair);
    }

    .filters.hidden {
      display: none;
    }

    .sel {
      height: 34px;
      border: 2px solid var(--hair);
      background: var(--bg);
      color: var(--fg);
      padding: 0 8px;
      font: 14px/1.2 inherit;
    }

    .fastlane {
      padding: 12px 0 16px;
      border-top: 1px solid var(--hair);
      display: none;
    }

    .fastlane.open {
      display: block;
    }

    .fl-grid {
      display: grid;
      grid-template-columns: repeat(6, minmax(0, 1fr));
      gap: 8px;
    }

    .fl-item {
      border: 1px solid var(--hair);
      padding: 18px 8px;
      text-align: center;
      user-select: none;
      cursor: pointer;
    }

    .fl-item .ico {
      width: 20px;
      height: 20px;
      margin: 0 auto 8px;
      border: 2px solid var(--acc);
    }

    .fl-item span {
      font-size: 12px;
      color: var(--muted);
    }

    .hdr.is-filters {
      height: calc(var(--hdr-h) + 60px);
    }

    .hdr.is-fastlane {
      height: calc(var(--hdr-h) + 260px);
    }

    /* Page grid */
    .page {
      max-width: 1240px;
      margin: 12px auto;
      padding: 0 16px;
      display: grid;
      grid-template-columns: var(--railW) minmax(0, 1fr) var(--asideW);
      gap: 16px;
    }

    /* Responsive */
    @media (max-width: 1080px) {
      :root {
        --asideW: 300px;
      }
    }

    @media (max-width: 940px) {
      .page {
        grid-template-columns: var(--railW) 1fr;
      }

      .aside {
        display: none;
      }
    }

    @media (max-width: 700px) {
      .page {
        grid-template-columns: 1fr;
      }

      .types {
        position: static;
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
      }

      .type {
        margin: 0;
        width: 100px;
      }

      .island .inner {
        grid-template-columns: 1fr;
      }

      .thumb {
        width: 100%;
        height: 140px;
      }
    }

    .wrap {
      width: min(92vw, 640px);
      text-align: center;
      margin: 0 auto;
      padding-top: var(--hdr-h);
    }

    /* Logo area */
    #logo {
      position: relative;
      margin: 0 auto 24px;
      display: grid;
      place-items: center;
      overflow: hidden;
      user-select: none;
    }

    #logo img,
    #logo iframe {
      width: 100%;
      height: 100%;
      display: block;
      border: 0;
      background: transparent;
    }

    /* Default text logo (shown when no asset or as fallback) */
    .logo-text {
      font-family: "Fira Sans Extra Condensed", sans-serif;
      font-weight: 400;
      letter-spacing: .5px;
      font-size: clamp(56px, 11vw, 104px);
      line-height: 1;
    }

    .logo-text .i {
      color: var(--logo-blue);
    }

    .logo-text .rest {
      color: var(--fg);
    }

    .bar-search-button {
      height: 100%;
      width: 96px;
      background: var(--acc);
      border: none;
    }

    .bar-param-button {
      height: 100%;
      background: var(--acc);
      border: none;
    }

    .search {
      width: 100%;
    }
    
    .search-table {
      display: flex;
      width: 100%;
      height: 40px;
    }
  </style>
</head>

<body>
  <header id="hdr" class="hdr" style="--hdr-h:72px">
    <div class="hdr-inner">
      <div class="bar">
        <a href="/" aria-label="Index home">
          <img class="logo-img" src="resources/service-icons/mini-mini.png" alt="Index">
        </a>

        <div style="display:flex; gap:8px;">
          <button id="fastlaneBtn" class="icon-btn" aria-label="Fastlane">
            <img class="icon" src="resources/svg/dashboard_24dp_E3E3E3_FILL0_wght400_GRAD0_opsz24.svg">
          </button>
        </div>
      </div>

      <div id="fastlane" class="fastlane" aria-hidden="true">
        <div class="fl-grid">
          <div class="fl-item">
            <div class="ico"></div><span>Web</span>
          </div>
          <div class="fl-item">
            <div class="ico"></div><span>Images</span>
          </div>
          <div class="fl-item">
            <div class="ico"></div><span>Video</span>
          </div>
          <div class="fl-item">
            <div class="ico"></div><span>Maps</span>
          </div>
          <div class="fl-item">
            <div class="ico"></div><span>News</span>
          </div>
          <div class="fl-item">
            <div class="ico"></div><span>Translate</span>
          </div>
          <div class="fl-item">
            <div class="ico"></div><span>Mail</span>
          </div>
          <div class="fl-item">
            <div class="ico"></div><span>Docs</span>
          </div>
          <div class="fl-item">
            <div class="ico"></div><span>Settings</span>
          </div>
          <div class="fl-item">
            <div class="ico"></div><span>Profile</span>
          </div>
          <div class="fl-item">
            <div class="ico"></div><span>Shortcuts</span>
          </div>
          <div class="fl-item">
            <div class="ico"></div><span>Labs</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div id="logo" title="Click to shuffle (R to shuffle)">
      <div class="logo-text" aria-label="Index">
        <span class="i">I</span><span class="rest">ndex</span>
      </div>
    </div>
    <div class="search-table">
      <form class="search" action="/search" method="GET" autocomplete="off">
        <input class="q" id="q" name="q" type="search" placeholder="Search the index" autofocus />
      </form>
      <button class="bar-search-button">Go</button>
    </div>
  </main>

  <script>
    // Random logo assets
    // Put your files in frontend/logo/ and list them in manifest.json:
    // { "assets": ["index-doodle.html", "alt.gif", "mark.svg"] }
    const ASSET_DIR = "resources/logo/";
    let LOGO_ASSETS = [
      // Fallback examples â€” replace with your own
      "copycat.html",
      "proc.html",
      "flashlight.html",
      "pongpong.html",
      "magnet.html"
      // "alt.gif",
      // "mark.svg"
    ].map(x => ASSET_DIR + x);

    const $logo = document.getElementById("logo");

    // Try to load manifest.json; falls back to the inline list if missing
    (async function initAssets() {
      try {
        const res = await fetch(ASSET_DIR + "manifest.json", { cache: "no-store" });
        if (res.ok) {
          const json = await res.json();
          if (Array.isArray(json.assets) && json.assets.length) {
            LOGO_ASSETS = json.assets.map(x => ASSET_DIR + x);
          }
        }
      } catch (_) { }
      loadRandomLogo();
    })();

    const isHTML = p => /\.html?$/i.test(p);
    const isImg = p => /\.(png|jpe?g|gif|svg|webp|avif)$/i.test(p);

    function showDefaultLogo() {
      $logo.innerHTML = `
        <div class="logo-text" aria-label="Index">
          <span class="i">I</span><span class="rest">ndex</span>
        </div>`;
    }

    async function loadRandomLogo() {
      if (!LOGO_ASSETS.length) return showDefaultLogo();
      const pick = LOGO_ASSETS[Math.floor(Math.random() * LOGO_ASSETS.length)];
      await showAsset(pick);
    }

    async function showAsset(url) {
      const lower = url.toLowerCase();
      if (isHTML(lower)) {
        // Load HTML logos via iframe so their JS runs
        $logo.innerHTML = "";
        const frame = document.createElement("iframe");
        frame.src = url;
        frame.loading = "eager";
        frame.title = "Index logo";
        frame.setAttribute("aria-label", "Index logo");
        // No sandbox so local doodles can run scripts; add if you need isolation.
        $logo.appendChild(frame);
      } else if (isImg(lower)) {
        $logo.innerHTML = "";
        const img = new Image();
        img.alt = "Index logo";
        img.decoding = "async";
        img.src = url;
        $logo.appendChild(img);
      } else {
        showDefaultLogo();
      }
    }

    // Shuffle on click when possible (clicks inside iframes don't bubble)
    $logo.addEventListener("click", (e) => {
      // If click is on the iframe, parent won't receive it; this still helps for images/text logo.
      if (e.target === $logo) loadRandomLogo();
    });

    // Focus the search box on load
    window.addEventListener("load", () => {
      const q = document.getElementById("q");
      if (q) q.focus({ preventScroll: true });
    });
    const hdr = document.getElementById('hdr');
    const fastlaneBtn = document.getElementById('fastlaneBtn');
    const fastlane = document.getElementById('fastlane');

    let fastlaneOpen = false;

    function applyHeaderState() {
      hdr.classList.toggle('is-fastlane', fastlaneOpen);
      fastlane.classList.toggle('open', fastlaneOpen);
      fastlane.setAttribute('aria-hidden', String(!fastlaneOpen));
    }

    fastlaneBtn.addEventListener('click', () => {
      fastlaneOpen = !fastlaneOpen;
      applyHeaderState();
    });

    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && (fastlaneOpen)) {
        fastlaneOpen = false; applyHeaderState();
      }
    });
  </script>
</body>

</html>